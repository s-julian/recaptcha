# reCAPTCHAv3 RL Agent
## CS 486 Section 1 Project

### Getting Started
- Dependencies<br>
Ensure Python, PyTorch, and Gymnasium are compatiable on your system. To setup a Python environment for the project use the following commands:
create env: ```python -m venv env```
activate env: ```source venv/bin/activate```
update pip: ```pip install --upgrade pip```
To install dependencies, activate your Python virtual environment and use the following command: ```pip install -r requirements.txt```
- Local Environment Variables<br>
create a .env file save it to the root directory with following information:
```
DEV_SERVER_PORT=<PORT_NUMBER>
DEV_SERVER_HOST=localhost
RECAPTCHA_SECRET=<SECRET_KEY>
TEST_URL=localhost::<PORT_NUMBER>/
```
- If you do not have access to Google reCAPTCHA v3 access but would like to test use: https://www.google.com/recaptcha/api2/demo

### Verify Local Environment is Setup Correctly
- Test pytorch environment by running test.py with command ```python3 test.py```. Output should specify what device is being used by pytorch (CUDA, Apple MPS, or CPU)
- Test FastAPI by running server.py with command ```fastapi dev server.py```.
	- visit the following endpoints to verify the server is running:
		- http://127.0.0.1:8000/

### How to Run
1. Start local web server by running in server.py in your IDE or with the following command: ```fastapi dev server.py```
2. Open a web browser and ensure only the new tab page is open.
3. Run ppo.py (ppo2.py works the same way) from IDE or command line. Switch to the web browser with new tab page within three (3) seconds (can be changed).
4. Do no interact with computer until training or evaluation has completed. Moving the mouse can negatively effect the RL agent's ability to interact with the live environment.

### Key Components
- GridWorld.py: This class uses OpenCV template matching to find a target on the active display/window and constructs a grid world from the live environment. 
- Navigator.py: This class enables navigation in the grid world. Acceptable movements in Navigator include up, down, left, and right. Wait is ignored by Navigator to save time.
- pag_nav.py: This module implements PyAutoGUI functions. The functions implemented allow automated movement to a specific pixel in the live environment, navigating to a URL in a web browser, opening a new browser tab, closing a browser tab, and switching browser tabs
- ppo.py: The PPO here is a modified version of this PPO: https://github.com/vwxyzjn/ppo-implementation-details/blob/main/ppo.py . For implementation details: https://iclr-blog-track.github.io/2022/03/25/ppo-implementation-details/ . Logs and models generated by the policy are stored in ./data/gridworld_ppo_logs. This PPO module contains a training and evaluation function for the building an RL agent. max_steps is used to prevent agent evaluation from running indefinitely.
- ppo2.py: An alternative to the previous PPO. Additional information can be found here: https://github.com/nikhilbarhate99/PPO-PyTorch. Working this PPO module is still on going. A training and evaluation loop has not been implemented but similar functions to test the policy and Gymnasium environment.
- random_policy: This is random RL policy mostly used for testing. It is unlikely that this policy will be useful for navigating to a target or emulating human-like movement.
- ScreenGridWorldEnv, located in ./envs/gridworld_env.py, is an Gymansium environment for use with ppo.py and random_policy.py
- DiscreteGridWorldEnv, located in ./envs/gridw2.py, is an Gymansium environment for use with ppo2.py. This based on ScreenGridWorldEnv but modified to work with ppo2.py.
- server.py: The server hosts a test webpage with a checkbox and Google reCAPTCHA v3 active. It also returns the score from a bot or human interacting with the webpage. This uses FastAPI.
- test.py: This is a simple file that checks whether a CUDA, MPS (Apple GPU), or CPU (last option) are available for use with PyTorch.

### Documentation
- Gymnasium: https://gymnasium.farama.org/introduction/basic_usage/
- Selenium: https://www.selenium.dev/documentation/
- PyAutoGUI: https://pyautogui.readthedocs.io/en/latest/index.html
- FastAPI: https://fastapi.tiangolo.com
- Polars: https://docs.pola.rs
